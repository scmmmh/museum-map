{"version":3,"sources":["webpack:///./src/views/Lobby.vue","webpack:///./src/views/Lobby.vue?246e","webpack:///./src/views/Lobby.vue?253c"],"names":["class","ref","floors","floor","key","id","setMapFloorId","attributes","label","topics","topic","to","relationships","room","data","style","sampleWidth","samples","item","src","thumbImageURL","images","alt","title","this","$store","state","objects","Object","values","sort","a","b","level","floorData","map","filter","items","length","$nextTick","updateSampleWidth","floorId","commit","imageId","split","join","child","$refs","lobbyList","querySelector","Math","clientWidth","components","render"],"mappings":"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","file":"js/lobby.35e9e750.js","sourcesContent":["<template>\n    <article class=\"lobby\">\n        <ol ref=\"lobbyList\">\n            <li v-for=\"floor in floors\" :key=\"floor.floor.id\">\n                <h2><button @click=\"setMapFloorId(floor.floor.id)\">{{ floor.floor.attributes.label }}</button></h2>\n                <ul class=\"topics\">\n                    <li v-for=\"topic in floor.topics\" :key=\"topic.id\">\n                        <router-link :to=\"{name: 'room', params: {rid: topic.relationships.room.data.id}}\">{{ topic.attributes.label }}</router-link>\n                    </li>\n                    <li><button @click=\"setMapFloorId(floor.floor.id)\">...</button></li>\n                </ul>\n                <ul class=\"samples\" :style=\"sampleWidth\">\n                    <li v-for=\"item in floor.samples\" :key=\"item.id\">\n                        <router-link :to=\"{name: 'item', params: {rid: item.relationships.room.data.id, iid: item.id}}\">\n                            <figure>\n                                <img :src=\"thumbImageURL(item.attributes.images[0])\" :alt=\"item.attributes.title ? item.attributes.title : '[untitled]'\"/>\n                            </figure>\n                        </router-link>\n                    </li>\n                </ul>\n            </li>\n        </ol>\n    </article>\n</template>\n\n<script lang=\"ts\">\nimport { Options } from 'vue-class-component';\n\nimport { ComponentRoot } from '@/base';\nimport { JSONAPIItem, JSONAPIReference } from '@/store';\n\ninterface LobbyEntry {\n    floor: JSONAPIItem;\n    rooms: LobbyEntryRoom[];\n}\n\ninterface LobbyEntryRoom {\n    room: JSONAPIItem;\n    group: JSONAPIItem;\n}\n\n@Options({\n    components: {\n    }\n})\nexport default class Lobby extends ComponentRoot {\n    public sampleWidth = '';\n\n    public get floors() {\n        if (this.$store.state.objects.floors) {\n            let floors = Object.values(this.$store.state.objects.floors);\n            floors = floors.sort((a, b) => {\n                if (a.attributes && b.attributes) {\n                    return (a.attributes.level as number) - (b.attributes.level as number);\n                } else if (a.attributes) {\n                    return -1;\n                } else if (b.attributes) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            });\n            const floorData = floors.map((floor) => {\n                if (floor.relationships) {\n                    const topics = (floor.relationships.topics.data as JSONAPIReference[]).map((ref) => {\n                        if (this.$store.state.objects['floor-topics'][ref.id]) {\n                            return this.$store.state.objects['floor-topics'][ref.id];\n                        } else {\n                            return null;\n                        }\n                    }).filter((item) => {\n                        return item !== null;\n                    });\n                    const samples = (floor.relationships.samples.data as JSONAPIReference[]).map((ref) => {\n                        if (this.$store.state.objects.items[ref.id]) {\n                            return this.$store.state.objects.items[ref.id];\n                        } else {\n                            return null;\n                        }\n                    }).filter((item) => {\n                        return item !== null;\n                    });\n                    return {\n                        floor: floor,\n                        samples: samples,\n                        topics: topics,\n                    };\n                } else {\n                    return null;\n                }\n            }).filter((item) => {\n                return item !== null;\n            });\n            if (floorData.length > 0) {\n                this.$nextTick(this.updateSampleWidth);\n            }\n            return floorData;\n        }\n        return [];\n    }\n\n    public setMapFloorId(floorId: string) {\n        this.$store.commit('setMapFloorId', floorId);\n    }\n\n    public thumbImageURL(imageId: string) {\n        if (imageId) {\n            return '/images/' + imageId.split('').join('/') + '/' + imageId + '-240.jpg';\n        } else {\n            return '';\n        }\n    }\n\n    public updateSampleWidth() {\n        const child = (this.$refs.lobbyList as HTMLElement).querySelector(':scope > li > h2');\n        if (child) {\n            this.sampleWidth = 'width:' + Math.floor(child.clientWidth / 96) * 96 + 'px';\n        }\n    }\n}\n</script>\n","\nimport { Options } from 'vue-class-component';\n\nimport { ComponentRoot } from '@/base';\nimport { JSONAPIItem, JSONAPIReference } from '@/store';\n\ninterface LobbyEntry {\n    floor: JSONAPIItem;\n    rooms: LobbyEntryRoom[];\n}\n\ninterface LobbyEntryRoom {\n    room: JSONAPIItem;\n    group: JSONAPIItem;\n}\n\n@Options({\n    components: {\n    }\n})\nexport default class Lobby extends ComponentRoot {\n    public sampleWidth = '';\n\n    public get floors() {\n        if (this.$store.state.objects.floors) {\n            let floors = Object.values(this.$store.state.objects.floors);\n            floors = floors.sort((a, b) => {\n                if (a.attributes && b.attributes) {\n                    return (a.attributes.level as number) - (b.attributes.level as number);\n                } else if (a.attributes) {\n                    return -1;\n                } else if (b.attributes) {\n                    return 1;\n                } else {\n                    return 0;\n                }\n            });\n            const floorData = floors.map((floor) => {\n                if (floor.relationships) {\n                    const topics = (floor.relationships.topics.data as JSONAPIReference[]).map((ref) => {\n                        if (this.$store.state.objects['floor-topics'][ref.id]) {\n                            return this.$store.state.objects['floor-topics'][ref.id];\n                        } else {\n                            return null;\n                        }\n                    }).filter((item) => {\n                        return item !== null;\n                    });\n                    const samples = (floor.relationships.samples.data as JSONAPIReference[]).map((ref) => {\n                        if (this.$store.state.objects.items[ref.id]) {\n                            return this.$store.state.objects.items[ref.id];\n                        } else {\n                            return null;\n                        }\n                    }).filter((item) => {\n                        return item !== null;\n                    });\n                    return {\n                        floor: floor,\n                        samples: samples,\n                        topics: topics,\n                    };\n                } else {\n                    return null;\n                }\n            }).filter((item) => {\n                return item !== null;\n            });\n            if (floorData.length > 0) {\n                this.$nextTick(this.updateSampleWidth);\n            }\n            return floorData;\n        }\n        return [];\n    }\n\n    public setMapFloorId(floorId: string) {\n        this.$store.commit('setMapFloorId', floorId);\n    }\n\n    public thumbImageURL(imageId: string) {\n        if (imageId) {\n            return '/images/' + imageId.split('').join('/') + '/' + imageId + '-240.jpg';\n        } else {\n            return '';\n        }\n    }\n\n    public updateSampleWidth() {\n        const child = (this.$refs.lobbyList as HTMLElement).querySelector(':scope > li > h2');\n        if (child) {\n            this.sampleWidth = 'width:' + Math.floor(child.clientWidth / 96) * 96 + 'px';\n        }\n    }\n}\n","import { render } from \"./Lobby.vue?vue&type=template&id=3e571b51\"\nimport script from \"./Lobby.vue?vue&type=script&lang=ts\"\nexport * from \"./Lobby.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}